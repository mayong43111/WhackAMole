# PoC_Spells

## 简介
此 PoC 主要用于验证**技能的可用性判断机制**，包括技能本身的基础条件（怒气/法力是否足够、是否在冷却、距离是否足够等）以及天赋触发时的特殊可用性状态。

### 核心验证目标
验证天赋触发时技能的可用性判断，例如：
*   **猝死（Sudden Death）**触发时，斩杀（Execute）可以无视目标血量使用
*   **战术大师（Tactical Mastery）**影响下，切换姿态时怒气保留
*   **瞬发（Instant Cast）Proc** 触发时的技能可用性（如火焰冲击后的熔岩爆裂）
*   其他天赋触发的技能使用条件变化

### 基础验证
*   技能 ID 映射是否正确
*   技能是否可用（法力/姿态/资源/距离等条件）
*   冷却时间计算是否准确

## 验证的 API
*   `GetSpellInfo(id/name)` - 获取技能基础信息
*   `IsUsableSpell(name)` - **核心 API**：判断技能是否可用（包括天赋触发状态）
*   `IsSpellInRange(name, unit)` - 判断技能是否在范围内
*   `GetSpellCooldown(name)` - 获取冷却时间
*   相关 Buff/Debuff 检测（用于验证天赋触发状态）

## 使用方法
1.  进入游戏，在插件列表中启用 **PoC_Spells**。
2.  插件加载后会自动显示：
    *   **技能监控窗口**（可拖动）- 实时显示技能状态
    *   **距离显示条**（可拖动）- 显示与目标的距离范围
3.  监控窗口实时显示技能可用性状态：
    *   **绿色背景** - 技能就绪，可以使用
    *   **金色背景（闪亮）** - 天赋 Proc 触发！（如猝死、血腥冲锋等）
    *   **蓝色背景** - 技能冷却中，显示剩余秒数
    *   **紫色背景** - 资源不足（怒气/法力不够）
    *   **橙色背景** - 目标超出范围
    *   **暗红色背景** - 不可用（条件不满足）
4.  距离显示条颜色说明：
    *   **红色** - 0-5码（近战范围）
    *   **橙色** - 5-10码（决斗范围）
    *   **黄色** - 10-28码（中距离）
    *   **灰色** - >28码（超出范围）
5.  命令：
    *   `/pocspell [SpellID]` - 测试特定技能（详细信息）
    *   `/pocspell show` - 显示监控窗口
    *   `/pocspell hide` - 隐藏监控窗口
    *   `/pocspell range` - 显示/隐藏距离显示条
6.  示例：
    *   `/pocspell 5308` (测试斩杀 Execute 详细信息)
    *   `/pocspell hide` (隐藏监控窗口)
    *   `/pocspell range` (切换距离显示)

## 预期结果
*   监控窗口实时显示技能可用性，颜色根据状态自动变化。
*   **天赋 Proc 触发时**，对应技能框会变成**金色背景**，非常显眼。
*   技能图标根据状态变灰/变亮，冷却时显示冷却动画。
*   **距离显示条**实时显示与目标的距离区间（基于 `CheckInteractDistance` 估算）。
*   命令测试模式能够正确输出技能名称、等级、资源消耗、冷却时间、距离范围等详细信息。
*   能够检测到所有活动的天赋触发 Buff（猝死、血之气息、血腥冲锋等）。

## 技术说明
### 距离检测原理
WotLK 3.3.5 客户端无法获取精确的目标距离值，插件使用以下方法估算距离区间：
*   `CheckInteractDistance(unit, 4)` - < 5 码（跟随范围）
*   `CheckInteractDistance(unit, 3)` - < 10 码（决斗范围）
*   `CheckInteractDistance(unit, 2)` - < 11.11 码（交易范围）
*   `CheckInteractDistance(unit, 1)` - < 28 码（检查装备范围）

参考了 HunterAssist 和 LibRangeCheck 的实现方式。

## 监控技能列表
默认监控以下战士技能（可在 Core.lua 中修改 `monitorSpells` 表）：
*   斩杀 (Execute) - 5308
*   压制 (Overpower) - 7384  
*   猛击 (Slam) - 1464
*   致死打击 (Mortal Strike) - 12294
*   英勇打击 (Heroic Strike) - 47450
