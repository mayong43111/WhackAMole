# PoC_Range - 距离检测验证工具

## 简介
此 PoC 专门用于验证 WotLK 3.3.5 中的距离检测 API。由于客户端限制，无法获取精确的目标距离值，只能通过 `CheckInteractDistance` API 估算距离区间。

## 核心验证目标
*   验证 `CheckInteractDistance` 各个参数的返回值
*   确认不同距离区间的检测准确性
*   测试友方与敌方单位的距离检测差异
*   为主插件提供可靠的距离估算方案

## 验证的 API
*   `CheckInteractDistance(unit, distanceIndex)` - 核心距离检测 API
    - `distanceIndex = 4`: < 5 码（跟随范围）
    - `distanceIndex = 3`: < 10 码（决斗范围）
    - `distanceIndex = 2`: < 11.11 码（交易范围）
    - `distanceIndex = 1`: < 28 码（检查装备范围）
*   `UnitExists(unit)` - 单位存在性检查
*   `UnitCanAttack(unit1, unit2)` - 敌对关系判断

## 使用方法
1.  进入游戏，在插件列表中启用 **PoC_Range**。
2.  插件加载后会**自动显示**距离检测窗口（位于屏幕中央，可拖动）。
3.  选中目标后，窗口实时显示：
    *   **距离区间** - 例如 "0-5码"、"11-28码"、">28码" 等
    *   **当前区间高亮** - 在 CheckInteractDistance 详情中标记 ">>> 当前区间"
    *   **API 检测详情** - 显示 4 个 CheckInteractDistance 的原始返回值（✓/✗）
4.  界面特性：
    *   **可拖动** - 点击窗口任意位置拖动
    *   **关闭按钮** - 右上角可关闭窗口
    *   **深色主题** - 现代化的深色半透明背景
    *   **低性能消耗** - 5 FPS 更新频率，无调试输出
5.  命令：
    *   `/range` - 显示/隐藏距离检测窗口

## 测试方法
1.  **近距离测试（0-5码）**
    *   站在目标旁边，观察所有 CheckInteractDistance 是否返回 ✓
    *   确认主显示为 "0-5码" 且 [4] Follow 行显示 ">>> 当前区间"

2.  **中距离测试（5-28码）**
    *   慢慢后退，观察各个距离阈值的变化
    *   验证 10 码、11 码、28 码的临界点
    *   确认当前区间高亮正确移动到对应的检测行

3.  **远距离测试（>28码）**
    *   移动到远处，确认所有 CheckInteractDistance 返回 ✗
    *   确认显示为 ">28码" 且底部显示 ">>> 当前区间: >28码"

4.  **友方 vs 敌方**
    *   对比友方和敌方单位的检测结果
    *   某些距离检测可能因关系不同而有差异

## 预期结果
*   距离区间估算准确，与实际游戏体验一致
*   当前区间高亮清晰标记在对应的 CheckInteractDistance 检测行
*   API 检测详情清晰显示各个阈值的原始判断结果（✓/✗）
*   切换目标时立即更新显示
*   界面简洁美观，性能消耗低

## 技术说明
### API 限制
WotLK 3.3.5 客户端**不支持**以下现代 API：
*   `UnitDistanceSquared(unit)` - 不存在
*   `C_Navigation.GetDistance(unit)` - 不存在
*   精确的数值距离获取

因此只能使用 `CheckInteractDistance` 进行区间判断。

### 参考实现
本工具参考了以下主流插件的实现：
*   **HunterAssist** - 猎人距离显示插件
*   **LibRangeCheck-3.0** - WeakAuras 使用的距离检测库
*   **RangeDisplay** - 距离显示插件

### 已知问题
*   无法获取精确到 1 码的距离值
*   某些特殊情况下（如飞行、水下）检测可能不准确
*   跨层、跨位面时距离检测失效

## 适用场景
此 PoC 的验证结果将用于：
*   WhackAMole 主插件的距离判断逻辑
*   技能范围检测（近战 5 码、远程 30 码等）
*   AI 决策中的距离条件判断
*   UI 显示中的距离提示
