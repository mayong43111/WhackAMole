# WhackAMole 详细设计文档索引

## 文档说明

本目录包含 WhackAMole 插件各功能模块的详细设计文档。这些文档基于**已实现的代码**编写，目的是补全设计文档体系，为维护和扩展提供参考。

---

## 📐 架构总览

**[00 - 架构图与流程图](00_Architecture_Diagrams.md)** ⭐️ **推荐首读**
- 系统分层架构图
- 模块依赖关系图
- 技能决策完整流程
- APL 编译与执行流程
- 状态快照与查询缓存机制
- 钩子系统事件流
- Grid UI 拖拽绑定流程
- 性能优化关键点脑图
- 模块通信模式

---

## 文档结构

### 核心层 (Core Layer)

1. **[生命周期与主控制器](01_Core_Lifecycle.md)**
   - 插件初始化流程
   - 事件注册与分发
   - 帧更新循环
   - 命令行接口

2. **[配置管理系统](02_ProfileManager.md)**
   - 配置加载与保存
   - 内置配置与用户配置
   - 配置切换机制
   - 配置校验

3. **[专精检测](03_SpecDetection.md)**
   - 职业与专精识别
   - 天赋指纹机制
   - 天赋变更监听

4. **[序列化与导入导出](04_Serializer.md)**
   - 配置序列化格式
   - 压缩与编码机制
   - 导入校验与容错

5. **[音频系统](05_Audio.md)**
   - 音频文件映射
   - 播放触发逻辑
   - 节流与去重机制

6. **[日志与调试](06_Logger.md)**
   - 日志级别与输出
   - 调试命令
   - 性能分析器

### 引擎层 (Engine Layer)

7. **[状态快照系统](07_State.md)**
   - 状态快照结构
   - Context 构建机制
   - 查询缓存系统
   - 对象池机制
   - 虚拟时间推进

8. **[SimC 解析器](08_SimCParser.md)**
   - APL 语法定义
   - 词法分析
   - 语法分析与 AST
   - 条件编译
   - 脚本缓存

9. **[APL 执行器](09_APLExecutor.md)**
   - 执行流程
   - 动作推荐逻辑
   - 预测机制
   - 错误处理

### 表现层 (Presentation Layer)

10. **[网格 UI](10_Grid_UI.md)**
    - 网格布局与渲染
    - 槽位管理
    - 拖拽绑定
    - 高亮动画
    - 锁定/解锁模式

11. **[配置界面](11_Options_UI.md)**
    - 配置面板结构
    - APL 编辑器
    - 布局编辑器
    - 导入/导出界面
    - 音频控制

### 数据层 (Data Layer)

12. **[职业模块](12_Class_Modules.md)**
    - 职业模块结构
    - SpellID 映射表
    - 天赋定义
    - 默认 APL
    - 默认布局

13. **[动作映射](13_ActionMap.md)**
    - 动作到技能的映射
    - SpellID 查询
    - 特殊动作处理

### 扩展与钩子 (Extensions)

14. **[钩子系统](14_Hooks.md)**
    - 钩子事件定义
    - 注册与触发机制
    - 错误隔离

### 高级特性 (Advanced Features)

15. **[预测系统](15_Prediction_System.md)** ⭐️ **新增**
    - 虚拟时间推进机制
    - 施法检测与缓存策略
    - 主推荐冻结逻辑
    - 双光效渲染（金色/蓝色）
    - 性能优化与日志去重
    - WoW 3.3.5 API 时序问题解决方案

---

## 阅读顺序建议

### 新手入门
1. 生命周期与主控制器 → 配置管理 → 网格 UI → 配置界面

### 理解决策流程
1. 状态快照 → SimC 解析器 → APL 执行器

### 扩展职业支持
1. 职业模块 → 动作映射 → 专精检测

### 性能优化
1. 状态快照（缓存机制）→ SimC 解析器（脚本缓存）→ 日志与调试（性能分析）

---

## 文档版本
- **版本**: 1.1
- **最后更新**: 2026-01-26
- **对应代码版本**: WhackAMole v2.1

---

## 更新历史

### 2026-01-26 (v1.1)
- ✅ 新增 [15_Prediction_System.md](15_Prediction_System.md) - 预测系统详细设计
  - 虚拟时间推进机制
  - WoW 3.3.5 API 时序问题解决方案（事件缓存策略）
  - 施法期间主推荐冻结逻辑
  - 双光效渲染实现（金色主推荐 + 蓝色预测）
  - 性能优化：智能节流、日志去重、UI状态缓存

### 2026-01-22 (v1.0)
- 初始版本，包含14个核心模块文档

---

## 维护说明

- 每个详细设计文档应包含：
  - 模块职责
  - 关键数据结构
  - 核心算法/流程
  - API 接口
  - 依赖关系
  - 已知限制
  - 相关代码文件

- 文档更新时机：
  - 模块重构后
  - 新增核心功能
  - 修复重大缺陷
  - API 变更
