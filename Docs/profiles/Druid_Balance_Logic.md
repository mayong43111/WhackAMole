# 泰坦重铸 (Titan Forged) 平衡德鲁伊输出逻辑文档 - T1阶段

## 版本更新日志
### v2.0 (2026-01-25)
- 🔥 **基于WCL高端数据优化**：分析拉格纳罗斯25人高端平衡德战斗日志
- ✅ 添加精灵之火：开局debuff（+3%伤害）
- ✅ 调整开局序列：精灵之火 → 愤怒 → 星辰坠落 → 月火术 → 推蚀
- ✅ 放宽 DoT刷新条件：月火<8秒，虫群<6秒（原<5秒/<3秒）
- ✅ 优化APL逻辑：开局立即上DoT，不等待蚀循环

### v1.1 (2026-01-25)
- 🔧 修复技能图标不显示问题：重构技能数据库，添加ActionMap映射机制
- ✅ 规范化专精ID：Balance (102), Feral (103), Restoration (105)
- ✅ 改进专精检测逻辑：使用IsPlayerSpell判断天赋技能

### v1.0 (初始版本)
- 实现日月蚀循环基础逻辑
- 针对魔改T1套装（星辰坠落+2秒）优化

---

## 关于服务器版本 - 泰坦重铸 (Titan Forged)
**确认信息**: 这是一个基于 3.3.5a (巫妖王之怒) 核心的中国区特别版本服务器。
- **技能系统**: 使用完整的巫妖王之怒技能机制（日月蚀循环、野性成长、星辰坠落等）
- **装备系统**: 使用魔改的经典旧世T1套装（当前阶段），套装效果针对WOTLK机制重新设计
本插件逻辑完全遵循 3.3.5a 机制，并针对服务器的**魔改T1套装**特效进行优化。

## 核心机制
3.3.5a 版本的平衡德鲁伊是一个基于**日月蚀循环（Eclipse）**的能量平衡系统。

### 属性说明 (Attributes)
**关于平衡德鲁伊的属性**:
*   平衡德鲁伊在 3.3.5a 是标准的远程法系DPS，依赖法术强度和暴击。
*   **日月蚀系统**: 通过施放愤怒（Wrath）和星火（Starfire）积累能量条，交替触发日蚀（Solar Eclipse，+40%奥术/自然伤害）和月蚀（Lunar Eclipse，+40%自然伤害）。

### 属性优先级 (Stats Priority)
1.  **命中 (Hit)**: 17% (达标) - 对于法术伤害，需要17%法术命中
    *   团队配置完善（暗牧/鸟德自带 +3%，德莱尼 +1%）时，装备提供 13%-14% 即可
2.  **法术强度 (Spell Power)**: 核心属性，提供所有法术的基础伤害
3.  **暴击 (Crit)**: 重要属性，提升输出和法力回复（通过梦境之境天赋）
4.  **急速 (Haste)**: 提升施法速度和DoT跳动频率，收益良好
5.  **精神 (Spirit)**: 通过【枭兽形态】天赋转换为法术伤害（约23%转化率）

### 套装特效 - 魔改T1 (雷霆之心战甲)
泰坦重铸服务器的 T1 套装针对WOTLK机制重新设计：

*   **2T1**: 【自然之力】天赋召唤的树人数量提高 **1个**
    *   **机制说明**: 
        - **自然之力 (Force of Nature)**: CD 3分钟，召唤3个树人战斗30秒
        - **2T1后**: 召唤4个树人（+33%树人数量）
    *   **实战价值**: 
        - 树人伤害约占总输出的3-5%，增加1个树人意味着提升约1.5%总体DPS
        - 更多树人提供更多AOE清场能力
    *   **优先级**: 中等。主要为凑4件套的过渡效果
    
*   **4T1**: 【星辰坠落】天赋的持续时间提高 **2秒**
    *   **机制说明**: 
        - **星辰坠落 (Starfall)**: CD 90秒，持续10秒的AOE伤害技能
        - **4T1后**: 持续时间从10秒延长至12秒（+20%持续时间）
    *   **实战意义**: 
        - 星辰坠落是平衡德最强AOE技能，单目标也有可观伤害（约占5-8%总伤害）
        - 持续时间延长20%意味着多2次伤害波次（每秒1次）
        - **数学模型**: 假设星辰坠落基础伤害10万
            - 无套装: 10秒 × 1万/秒 = 10万伤害
            - 4T1后: 12秒 × 1万/秒 = 12万伤害 (+20%星辰坠落伤害)
    *   **优化策略**: 星辰坠落CD好就用，尤其在日蚀/月蚀期间
    
*   **重点**: 魔改T1专注于强化**爆发技能的持续能力**，2T1增强召唤物，4T1延长顶级AOE技能持续时间

## 技能数据 (Spell Data)

| 技能名称 | ID | 说明 |
|-------|----|------|
| **愤怒 (Wrath)** | 48461 | 快速施法自然伤害。推动日蚀能量条，触发日蚀。 |
| **星火 (Starfire)** | 48465 | 慢速施法奥术/自然伤害。推动月蚀能量条，触发月蚀。 |
| **月火术 (Moonfire)** | 48463 | 瞬发DoT，维持高优先级。 |
| **虫群 (Insect Swarm)** | 48468 | 瞬发DoT，维持高优先级。需要天赋支持。 || **精灵之火 (Faerie Fire)** | 770 | 瞬发debuff，降低目标护甲，增加伤害。开局必上。 || **星辰坠落 (Starfall)** | 53201 | 最强AOE技能。CD 90秒，持续10秒（4T1后12秒）。 |
| **自然之力 (Force of Nature)** | 33831 | 召唤3个树人（2T1后4个）。CD 3分钟。 |
| **台风 (Typhoon)** | 61384 | 击退+伤害，可作为填充或紧急控制。 |
| **飓风 (Hurricane)** | 48467 | 引导型AOE，固定站位时使用。 |

## 关键状态 (Buffs & Debuffs)

*   **日蚀 (Solar Eclipse)** (Buff): ID `48517`
    - 愤怒和星火的自然/奥术伤害提高40%
    - 持续15秒
    - **核心价值**: 日蚀期间主要施放愤怒，享受伤害加成
    
*   **月蚀 (Lunar Eclipse)** (Buff): ID `48518`
    - 愤怒和星火的自然伤害提高40%
    - 持续15秒
    - **核心价值**: 月蚀期间主要施放星火，享受伤害加成
    
*   **月火术 (Moonfire)** (Debuff): ID `48463`
    - 瞬发DoT，21秒持续时间
    - 维持高优先级，DoT伤害占比约15-20%
    
*   **虫群 (Insect Swarm)** (Debuff): ID `48468`
    - 瞬发DoT，12秒持续时间
    - 维持高优先级，DoT伤害占比约10-15%

*   **枭兽形态 (Moonkin Form)** (Buff): ID `24858`
    - 平衡德必备形态，提供护甲和法术强度
    - 自动激活，无需手动施放

## 逻辑分析 (优先级队列)

### 插件设计目标

本插件提供**稳定的技能循环建议**，不包括：
- ❌ 爆发药水、工程道具
- ❌ 团队技能（能量涌动等）
- ❌ 饰品、装备特效
- ❌ 复杂的爆发时间轴

插件聚焦于：
- ✅ 日月蚀循环管理
- ✅ 技能CD判断
- ✅ DoT维持逻辑
- ✅ 简洁易懂的优先级

### 实战循环分析（基于WCL顶级平衡德日志）

**WCL数据来源**：拉格纳罗斯25人 Normal，战斗时长 2:12.8 (132.8秒)

**技能使用频率**：

| 技能 | 使用次数 | 平均频率 | 关键发现 |
|------|----------|---------|----------|
| 愤怒 | 57次 | 2.3秒/次 | 日蚀期间和填充，读条0.81-1.5秒 |
| 星火术 | 31次 | 4.3秒/次 | 月蚀期间，读杠1.50-2.20秒 |
| 星辰坠落 | 3次 | 44.3秒/次 | ✅ CD好就用（约90秒使用一次） |
| 月火术 | 3次 | 44.u79d2/次 | ⚠️ 开局+刷新（约45秒一次） |
| 虫群 | 3次 | 44.3秒/次 | ⚠️ 开局+刷新（约40秒一次） |
| 精灵之火 | 1次 | 132.8秒 | ✅ 开局debuff（+3%伤害） |

**日月蚀循环数据**：
- 月蚀触发4次：08.1s, 56.9s, 90.3s, 122.7s
- 日蚀触发3次：31.7s, 73.6s, 106.2s
- 循环间隔：首次较长（23.6秒），后续稳定在16-17秒

**开局序列（0-10秒）**：
```
00:00.9: 精灵之火（debuff）
00:03.5: 愤怒 + 星辰坠落（CD技能）
00:05.5: 愤怒 + 月火术（DoT）
00:07.4: 愤怒
00:08.1: 月蚀触发 ← 5次愤怒触发月蚀
00:09.4: 三个饰品爆发（超级加速器+短暂强力+能量涌动）
00:11-31: 连续14次星火术
00:25.0: 虫群（DoT）
00:31.7: 日蚀触发
```

**关键发现**：
1. ✅ **开局立即上DoT**：月火术在5秒，虫群在25秒，不等待蚀循环
2. ✅ **精灵之火开局**：战斗开始立即施放（+3%伤害debuff）
3. ✅ **星辰坠落早用**：开局第3秒使用，配合爆发饰品
4. ✅ **日月蚀100% spam**：月蚀期间连续14次星火术，日蚀期间连续愤怒
5. ⚠️ **DoT刷新频率低**：全程仅3次，不打断日月蚀循环

**v2.0优化调整**：
- ✅ 添加精灵之火到APL
- ✅ 开局立即上DoT（不等待蚀循环）
- ✅ 放宽 DoT刷新条件：月火<8秒，虫群<6秒
- ✅ 保持星辰坠落CD好就用逻辑

### 常规单体循环（推荐）

**优先级队列**:
```
1. 精灵之火 - 开局debuff（+3%伤害）
2. 月火术 - 开局立即上DoT
3. 虫群 - 开岀立即上DoT
4. 星辰坠落 - CD好立即使用
5. 星火术 - 月蚀Buff期间（+40%伤害）
6. 愤怒 - 日蚀Buff期间（+40%伤害）
7. 月火术 - DoT剩余<8秒时刷新
8. 虫群 - DoT剩余<6秒时刷新
9. 愤怒 - 主要填充技能，推动日蚀循环
```

**核心思路**:
- **开岀优先**：精灵之火 + 月火术 + 虫群，不等待蚀循环
- **日月蚀是核心**：在Buff期间100% spam对应技能，享厗40%伤害加成
- **DoT放宽刷新**：月火<8秒，虫群<6秒，不要打断日月蚀循环
- **星辰坠落CD好就用**：不等待完美时机
- **愤怒是默认填充**：无Buff时使用愤怒推动循环

### AOE循环

**优先级队列**:
```
1. 星辰坠落 - 顶级AOE（4T1后持续12秒）
2. 月火术 - 多目标铺DoT
3. 虫群 - 多目标铺DoT
4. 飓风 - 固定站位引导AOE
5. 台风 - 快速AOE爆发
```

**核心思路**:
- 星辰坠落是顶级AOE，CD好就用
- 高价值目标铺DoT
- 飓风需要固定站位，移动战不推荐

## APL配置 - T1阶段

### 单体循环APL

**技能配置**:
```
技能1: 愤怒 (Wrath)
技能2: 星火 (Starfire)
技能3: 月火术 (Moonfire)
技能4: 虫群 (Insect Swarm)
技能5: 星辰坠落 (Starfall)
技能6: 精灵之火 (Faerie Fire)
技能7: 台风 (Typhoon)
技能8: 飓风 (Hurricane)
```

**APL脚本** (v2.0):
```
# 平衡德鲁伊APL - T1阶段 (v2.0)

# 开岀debuff
精灵之火, if=!debuff.faerie_fire.up

# 开岀DoT
月火术, if=!debuff.moonfire.up
虫群, if=!debuff.insect_swarm.up

# 爆发技能
星辰坠落

# 日月蚀循环
星火术, buff=月蚀
愤怒, buff=日蚀

# DoT刷新
月火术, dot_remains<8
虫群, dot_remains<6

# 主要填充
愤怒
```

## 战斗技巧

### 基础循环

**站桩输出**:
- 月蚀期间：100% spam星火术
- 日蚀期间：100% spam愤怒
- 无Buff时：愤怒推动循环
- 不要为了刷DoT打断日月蚀循环

**日月蚀响应**:
- 月蚀触发 → 立即切换星火术（+40%伤害）
- 日蚀触发 → 立即切换愤怒（+40%伤害）
- 在Buff期间最大化对应技能使用

**DoT管理**:
- 月火术：DoT剩余<5秒时刷新
- 虫群：DoT剩余<3秒时刷新
- 不要过度关注DoT，日月蚀循环才是核心

### 星辰坠落使用

**单体战斗**:
- CD好立即使用，不等待完美时机
- 约每60-90秒使用一次
- 4T1后持续12秒，伤害提升20%

**AOE战斗**:
- 顶级AOE技能
- 配合多目标DoT效果更佳
- 4T1效果在AOE场景收益最大

### 读条管理

**愤怒读条时间**（实战数据）:
- 日蚀期间：0.81-1.09秒
- 无Buff期间：1.3-1.5秒

**星火读条时间**（实战数据）:
- 月蚀期间：1.50-1.67秒
- 无Buff期间：1.95-2.20秒

**结论**: 日月蚀Buff对读条影响显著，必须在Buff期间最大化输出

### 常见错误

❌ **过度关注DoT维持**: DoT不是最高优先级，不要打断日月蚀循环
❌ **等待完美时机**: 星辰坠落CD好就用
❌ **忽视日月蚀Buff**: 40%伤害加成是DPS的核心
❌ **日蚀期间施放星火**: 违背日月蚀循环，浪费Buff

## 泰坦重铸特色说明 - T1阶段

### 实战数据（基于顶级平衡德日志）

**技能使用频率**（2:13战斗）:

| 技能 | 使用次数 | 占比 | 说明 |
|------|----------|------|------|
| 愤怒 | ~60次 | 55% | 日蚀期间和填充，读条0.81-1.5秒 |
| 星火术 | ~40次 | 37% | 月蚀期间，读条1.50-2.20秒 |
| 星辰坠落 | 3次 | 爆发 | 约每60-90秒使用 |
| 月火术 | 3次 | DoT | 约每45秒刷新 |
| 虫群 | 3次 | DoT | 约每40秒刷新 |
| 精灵之火 | 1次 | debuff | 开局 |

**日月蚀循环数据**:
- 月蚀触发4次（00:08, 00:56, 01:30, 02:02）
- 日蚀触发4次（00:31, 01:13, 01:46）
- 循环周期约20-25秒

**关键发现**:
- **日月蚀期间100% spam对应技能**
- **DoT刷新频率很低**，不打断日月蚀循环
- **星辰坠落优先使用**，CD好就用
- **没有使用树人**（单体Boss战收益低）

### 套装价值

**4T1核心价值**: 
- 星辰坠落持续时间从10秒延长至12秒（+20%）
- 单体Boss战约1-1.5%总体DPS提升
- AOE场景收益更大

**2T1价值**: 
- 自然之力树人+1（从3个增加至4个）
- 单体Boss战收益较低（约1.5%总体DPS）
- 过渡效果

### 装备优先级

**命中17%（达标）** → **法术强度** → **暴击** → **急速** → **精神**

**套装优先**: 4T1效果对星辰坠落提升明显，优先凑齐4件套

## 常见问题 (FAQ)

### 循环问题

**Q: 为什么DoT刷新条件放宽了？**
A: **v2.0基于WCL实战数据优化**：
- 高端玩家DoT刷新频率较低（约40-45秒一次）
- 不要为了刷DoT打断日月蚀循环
- 月火术：<8秒刷新（21秒持续）
- 虫群：<6秒刷新（12秒持续）

**Q: 什么时候刷新DoT？**
A: **在日月蚀Buff即将结束或过渡期刷新**：
- 开岀：精灵之火 → 愤怒 → 月火术 → 虫群 → 推蚀
- 刷新：月火<8秒，虫群<6秒
- 不要在日蚀/月蚀Buff高峰期刷DoT

**Q: 日月蚀循环如何管理？**
A: **简化逻辑**：
- 月蚀触发 → spam星火术，直到Buff结束
- 日蚀触发 → spam愤怒，直到Buff结束
- 无Buff时 → spam愤怒推动循环
- 循环周期约20-25秒

**Q: 星辰坠落什么时候用？**
A: **CD好立即使用**！
- 不要等待日蚀/月蚀
- 不要等待爆发期
- CD 90秒，战斗中用2-3次

### 天赋和装备

**Q: 4T1的星辰坠落持续时间延长有多重要？**
A: **重要，但不是核心**：
- 单体Boss战约1-1.5%总体DPS提升
- AOE场景收益更大
- 优先凑齐4件套

**Q: 树人（自然之力）为什么不用？**
A: **单体Boss战收益较低**：
- 树人伤害约占3-5%总伤害
- CD 3分钟，使用时机难以把握
- 可以选择性使用，不是必需

**Q: 日月蚀循环的核心是什么？**
A: **在Buff期间最大化对应技能使用**：
- 月蚀（+40%伤害）→ spam星火术
- 日蚀（+40%伤害）→ spam愤怒
- 这是平衡德DPS的核心机制

### 实战技巧

**Q: 如何最大化DPS？**
A: 
1. **日月蚀循环是核心**：在Buff期间100% spam对应技能
2. **不要过度关注DoT**：每40-45秒刷新即可
3. **星辰坠落CD好就用**：不等待完美时机
4. **读条管理**：保持连续读条，不要有GCD空档

**Q: 移动战如何输出？**
A: 
- 利用瞬发DoT：月火术、虫群
- 预判移动时机，提前施放DoT
- 避免在日蚀/月蚀高峰期移动
