# 巫妖王之怒 / 泰坦时光(Titan-Forged) 武器战输出逻辑文档

## 关于服务器版本 - 泰坦时光 (Titan Time)
**确认信息**: 这是一个基于 3.3.5a (巫妖王之怒) 核心的改版服务器。
本插件逻辑完全遵循 3.3.5a 机制，而非正式服的“泰坦造物”机制。

## 核心机制
3.3.5a 版本的武器战并不是一个死板的循环，而是一个基于**优先级**的动态系统。

### 属性说明 (Attributes)
**关于护甲穿透 (ArP)**:
*   很多玩家在面板上直接看不到“护甲穿透”，这是 3.3.5a 客户端 UI 的通病。
*   **查看方法**: 打开人物属性 (C) -> 在详细数据的下拉菜单中选择 **近战 (Melee)** -> 鼠标移动到 **命中** 或 **暴击** 一栏上，或者查找单独的“护甲穿透等级”。
*   **硬指标**: 1400 穿透等级 = 100% 无视护甲 (俗称“满破”)。这是本服后期依然生效的核心机制。

### 属性优先级 (Stats Priority)
**特别说明**: 在游戏前期 (例如纳克萨玛斯/奥杜尔阶段)，你可能很难找到带护甲穿透的装备。这是正常的。
*   **无破甲装备时**: 优先堆 **力量 (Strength)** 和 **暴击 (Crit)**。
*   **后期目标**: 当你能获取 TOC/ICC 级别装备 (物品等级 230+) 时，护甲穿透才会大量出现。

1.  **命中 (Hit)**: 8% (达标)
2.  **精准 (Exp)**: 26 (达标)
3.  **护甲穿透 (ArP)**:
    *   **前期**: 随缘，有就穿，没有不强求。
    *   **后期**: 必须硬满破 1400 (优先级 > 力量)。
4.  **暴击 (Crit)**: 前期核心属性。
5.  **力量 (Strength)**: 基础收益最高，前期核心。

### 检测命令
如果你不确定自己的破甲属性，可以在游戏聊天框输入以下命令查询：
`/run print("当前破甲等级:", GetCombatRating(25))`

## 技能数据 (Spell Data)

| 技能名称 | ID | 说明 |
|-------|----|------|
| **撕裂 (Rend)** | 772 | 必须全程保持。它是触发“压制”的唯一前置条件。 |
| **致死打击 (Mortal Strike)** | 12294 | 标志性技能。卡CD使用。 |
| **压制 (Overpower)** | 7384 | 仅在躲闪/招架或 **血之气息** 触发时可用。天赋支持下必爆。 |
| **斩杀 (Execute)** | 5308 | 高怒气消耗的终结技。**猝死** 触发时可无视血量使用。 |
| **利刃风暴 (Bladestorm)** | 46924 | 大招。高爆发 AOE/单体。 |
| **猛击 (Slam)** | 1464 | 填充技能。需要读条（但在高急速/高延迟环境下需谨慎）。 |
| **英勇打击 (Heroic Strike)** | 2048 | 不占用 GCD 的泄怒技能。替代下一次自动攻击。 |

## 关键状态 (Buffs & Debuffs)

*   **血之气息 (Taste for Blood)** (Buff): ID `60503`。撕裂每 6 秒触发一次，持续 9 秒。允许使用压制。
*   **猝死 (Sudden Death)** (Buff): ID `52437`。允许无视血量使用斩杀，并保留 10 点怒气。
*   **撕裂 (Rend)** (Debuff): ID `47465`。

## 逻辑分析 (优先级队列)

### 阶段一：常规阶段 (> 20% 血量)

1.  **撕裂 (Rend)**
    *   **条件**: 目标身上没有撕裂，或剩余时间 < 3秒。
    *   **理由**: 为了触发压制。即使在大后期满破甲环境下，流血伤害占比降低，但压制的怒气转化率（DPE）依然极高。

2.  **压制 (Overpower)**
    *   **条件**: `血之气息` Buff 存在，或技能亮起。
    *   **理由**: 5怒气必爆，无法被格挡/招架。不仅伤害高，而且极度节省怒气。
    *   **细节**: 如果 Buff 剩余时间 < 1.5秒，必须提到最高优先级以免浪费。

3.  **斩杀 (Execute) - 猝死触发**
    *   **条件**: `猝死` Buff 存在。
    *   **理由**: 免费（保留怒气）的一发大伤害。

4.  **致死打击 (Mortal Strike)**
    *   **条件**: 冷却就绪。
    *   **理由**: 核心伤害来源，挂致死 Debuff，刷新重伤。

5.  **利刃风暴 (Bladestorm)**
    *   **条件**: 冷却就绪，且**不是**猝死/压制触发期。
    *   **时机**: 尽量在该技能CD好时使用。但如果手里有压制/猝死，先打出去再转，否则转完了 Buff 也没了。

6.  **猛击 (Slam)**
    *   **条件**: 站桩（未移动），且怒气 > 20。
    *   **理由**: 填充技能。比等待平砍要好。

### 阶段二：斩杀阶段 (< 20% 血量)

**错误观念**: 到了 20% 就无脑按斩杀。
**正确思路**: 在 3.3.5 版本，满怒斩杀 DPE 很高，但低怒斩杀甚至不如致死。你需要维持怒气循环。

1.  **撕裂 (Rend)**: 依然保持！为了给压制提供触发。
2.  **压制 (Overpower)**: 依然打！5怒气打出必爆伤害，性价比远超低怒斩杀，是攒怒气打满怒斩杀的关键。
3.  **致死打击 (Mortal Strike)**: 如果怒气 > 40，可以用致死替代一发低怒斩杀（为了保持重伤）。或者仅在技能CD时作为填充。
    *   *Luminary 策略*: 采用 **压制 > 斩杀** 的策略。
4.  **斩杀 (Execute)**: 泄怒主要手段。

## 拟定 Lua 代码逻辑

```lua
-- 是否进入斩杀线
local execute_range = target.health_pct < 20

-- 1. 补撕裂 (最优先，为了触发压制)
if debuff(S_Rend).remains < 1.5 and target.time_to_die > 6 then
    return 4 -- 撕裂
end

-- 2. 处理猝死 (非斩杀期)
if not execute_range and buff(B_SuddenDeath).up then
    return 3 -- 斩杀
end

-- 3. 压制 (极高优先级)
if spell(S_Overpower).ready then
    return 2 -- 压制
end

-- 4. 斩杀阶段泄怒
if execute_range then
    -- 如果有压制，已经在上面打出去了
    return 3 -- 斩杀
end

-- 5. 致死打击
if spell(S_MortalStrike).ready then
    return 1 -- 致死
end

-- 6. 利刃风暴
if spell(S_Bladestorm).ready then
    return 6 -- 大风车
end

-- 7. 猛击 (填充)
if not player.moving and player.power.rage.current > 20 then
    return 5 -- 猛击
end
```

## 泰坦时光服特色说明
*   **满破甲 (100% ArP)**: 这会让物理技能（致死、斩杀、猛击）的伤害大幅提升。相比之下，流血（撕裂、重伤）的收益比例会下降，但撕裂作为压制的前置依然不可由断。
*   **T10 套装**: 4件套效果“撕裂和重伤造成伤害时有几率获得20%攻击强度”，这进一步强化了维持撕裂Debuff的重要性，即使是在木桩战中。
